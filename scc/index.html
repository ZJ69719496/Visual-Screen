<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=0.5, minimum-scale=0.5, maximum-scale=0.5, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>产线可视化看板</title>

    <style>
        * {
            padding: 0;
            margin: 0;
        }

        html,
        body {
            height: 100%;
            width: 100%;

        }

        body {
            background-color: #16171c;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .block {
            font-size: 15px;
            border: #01a5fe 1px solid;
            border-radius: 5px;
            box-shadow: 0 0 6px 1px #3795c1
        }

        .block2 {
            border: #01a5fe 1px solid;
            border-radius: 5px;
            box-shadow: 0 0 9px 3px #3795c1
        }

        .cycle {
            border-radius: 250px;
        }

    </style>

</head>

<body oncontextmenu=self.event.returnValue=false
    style="height:100%;width:100%;background-image:url(./bg.png);background-repeat: no-repeat;background-size: 100% 100%">
    <div id="content"
        style="width: 100%; height: 100%; position: absolute; transform: scale(0.752083, 0.685185); transform-origin: 0px 0px;">

        <!-- LOGO -->
        <div class="logo"
            style="height: 17px;width: 144px;position: absolute;left: 220px;top: 75px;background-image:url(./logo.png);background-repeat: no-repeat;background-size: 100% 100%;">
        </div>
        <!-- 大标题 -->
        <div
            style="width: 370px;font-size: 42px;font-weight: bold;background: linear-gradient(to top, #31baff, #d7edf9, #FDF7EE);-webkit-background-clip: text;color: transparent;height: 51px;/* width:100%; */position: absolute;left: 775px;top: 64px;text-align: center;">
            产 线 可 视 化 看 板</div>
        <div
            style="width: 361px;font-size: 21px;font-weight: bold;background: linear-gradient(to top, #31baff, #d7edf9, #FDF7EE);-webkit-background-clip: text;color: transparent;height: 22px;/* width:100%; */position: absolute;left: 775px;top: 113px;text-align: center;">
            Visual Kanban for Production Line</div>

        <!-- 时间 -->
        <div id="time" style="
                            font-size: 25px;
                            font-weight: bold;
                            background: linear-gradient(to top, #31baff, #d7edf9, #FDF7EE);
                            -webkit-background-clip: text;
                            color:
                            transparent;
                            position:absolute;
                            left: 1418px;
                            top: 67px;
                            ">00:00</div>
        <div id="date"
            style="font-size: 25px;font-weight: bold;background: linear-gradient(to top, #31baff, #d7edf9, #FDF7EE);-webkit-background-clip: text;color: transparent;position:absolute;left: 1506px;top: 67px;">
            01.01</div>
        <div id="week"
            style="width: 105px;font-size: 25px;font-weight: bold;background: linear-gradient(to top, #31baff, #d7edf9, #FDF7EE);-webkit-background-clip: text;color: transparent;position:absolute;left: 1603px;top: 67px;">
            星期一</div>


        <!-- 子标题 -->
        <div style="
                        width: 170px;
                        position:absolute;
                        left: 413px;
                        top: 187px;
                        background: linear-gradient(to top, #31baff, #98c0d8, #FDF7EE);
                        -webkit-background-clip: text;
                        color: transparent;
                        font-size: 42px;
                        ">生产计划</div>
        <div style="
                        width: 170px;
                        position:absolute;
                        left: 1348px;
                        top: 185px;
                        background: linear-gradient(to top, #31baff, #98c0d8, #FDF7EE);
                        -webkit-background-clip: text;
                        color: transparent;
                        font-size: 42px;
                        ">生产环境</div>
        <div style="
                        width: 221px;
                        position:absolute;
                        left: 383px;
                        top: 626px;
                        background: linear-gradient(to top, #31baff, #98c0d8, #FDF7EE);
                        -webkit-background-clip: text;
                        color: transparent;
                        font-size: 36px;
                        ">AGV配送状态</div>
        <div style="
                        width: 170px;
                        position:absolute;
                        left: 1347px;
                        top: 618px;
                        background: linear-gradient(to top, #31baff, #98c0d8, #FDF7EE);
                        -webkit-background-clip: text;
                        color: transparent;
                        font-size: 42px;
                        ">质量监控</div>

        <!-- 生产计划块 -->
        <div class="block"
            style="position: absolute;left: 73px;top: 255px;width: 140px;height: 44px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">班次</span>
            <span id="bc" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">E0012</span>
        </div>
        <div class="block"
            style="position: absolute;left: 251px;top: 255px;width: 140px;height: 44px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">当前订单</span>
            <span id="dd" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">aaaaaa</span>
        </div>
        <div class="block"
            style="position: absolute;left: 429px;top: 255px;width: 140px;height: 44px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">当前型号</span>
            <span id="xh" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">aaaaaa</span>
        </div>
        <div class="block"
            style="position: absolute;left: 604px;top: 255px;width: 140px;height: 44px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">今日目标</span>
            <span id="mb" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">100</span>
        </div>
        <div class="block"
            style="position: absolute;left: 777px;top: 255px;width: 140px;height: 44px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">今日完成</span>
            <span id="wc" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">80</span>
        </div>

        <div style="position: absolute;
        width: 867px;
        height: 270px;
        background-color: #1d282e;
        left: 62px;
        top: 318px;
        border-radius: 10px 10px 15px 15px;">
            <table style="width: 100%;height: 100%;">
                <thead>
                    <tr style="text-align:center;color: #42b3ef;font-weight: bold;font-size: 16px;">
                        <td>序号</td>
                        <td>订单号</td>
                        <td>标配人力</td>
                        <td>实际人力</td>
                        <td>计划数据</td>
                        <td>完成数量</td>
                        <td>状态</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="position: absolute;
        width: 867px;
        height: 336px;
        background-color: #1d282e;
        left: 62px;
        top: 688px;
        border-radius: 10px 10px 15px 15px; ">
            <table style="width: 100%;height: 100%;">
                <thead>
                    <tr style="text-align:center;color: #42b3ef;font-weight: bold;font-size: 16px;">
                        <td>序号</td>
                        <td>工位号</td>
                        <td>工位名称</td>
                        <td>配送状态</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 环境块 -->
        <div class="block2"
            style="font-size: 27px; position: absolute;left: 1065px;top: 290px;width: 200px;height: 90px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">温度</span>
            <span id="wd" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">23.2</span>
        </div>
        <div class="block2"
            style="font-size: 27px; position: absolute;left: 1335px;top: 290px;width: 200px;height: 90px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">湿度</span>
            <span id="sd" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">66.7</span>
        </div>
        <div class="block2"
            style="font-size: 27px; position: absolute;left: 1593px;top: 290px;width: 200px;height: 90px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">噪声</span>
            <span id="zs" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">74.9</span>
        </div>
        <div class="block2"
            style="font-size: 27px; position: absolute;left: 1065px;top: 452px;width: 200px;height: 90px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">天盖压力</span>
            <span id="tgyl" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">0.74</span>
        </div>
        <div class="block2"
            style="font-size: 27px; position: absolute;left: 1335px;top: 452px;width: 200px;height: 90px;background-color: rgba(25, 58, 218, 0);">
            <span style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top:10%">地盖压力</span>
            <span id="dgyl" style="text-align: center;width:100%;color:#c0e6fa;position:inherit;top: 49%;">0.74</span>
        </div>

        <!-- 质检块 -->
        <div id="qj" class="cycle"
            style="color:#3e98c8;font-size: 51px;border:#83fbee 5px solid;position: absolute;left: 1037px;top: 743px;width: 150px;height: 150px;background-color: rgba(25, 58, 218, 0);line-height: 150px;text-align: center;box-shadow: inset 1px 0px 20px 12px #337391;">
            0
        </div>
        <div id="cj" class="cycle"
            style="color:#3e98c8;font-size: 51px;border:#ecdba0 5px solid;position: absolute;left: 1342px;top: 743px;width: 150px;height: 150px;background-color: rgba(25, 58, 218, 0);line-height: 150px;text-align: center;box-shadow: inset 1px 0px 20px 12px #4f4d48;">
            0
        </div>
        <div id="fx" class="cycle"
            style="color:#3e98c8;font-size: 51px;border:#f7a587 5px solid;position: absolute;left: 1646px;top: 743px;width: 150px;height: 150px;background-color: rgba(25, 58, 218, 0);line-height: 150px;text-align: center;box-shadow: inset 1px 0px 20px 12px #6a4b3f;">
            0
        </div>
        <div style="width: 105px;color:#3e98c8;font-size: 24px;position: absolute;left: 1070px;top: 940px;">全检不良</div>
        <div style="width: 105px;color:#3e98c8;font-size: 24px;position: absolute;left: 1376px;top: 940px;">抽检不良</div>
        <div style="width: 105px;color:#3e98c8;font-size: 24px;position: absolute;left: 1679px;top: 940px;">报废数量</div>

        <!-- 通知 -->
        <div
            style="font-size:25px; font-weight: bold;position:absolute;width:1920px;height:20px;top: 1035px;color: #de2a12;">
            <marquee behavior="" direction="">MES系统上线中...</marquee>
        </div>
    </div>

    <script src="./jq.js"></script>
    <script>
        $(() => {
            var msg = [
                "\n %c %c %c MACROINF  - ✰  MES系统/SCADA数据采集/数据可视化/私有云平台  ✰  %c  %c  %c  http://www.macroinf.com/  %c %c ♥%c♥%c♥ \n\n",
                "background: #ff66a5; padding:5px 0;",
                "background: #ff66a5; padding:5px 0;",
                "color: #ff66a5; background: #030307; padding:5px 0;",
                "background: #ff66a5; padding:5px 0;",
                "background: #ffc3dc; padding:5px 0;",
                "background: #ffc3dc; padding:5px 0;",
                "background: #ff66a5; padding:5px 0;",
                "color: #ff2424; background: #fff; padding:5px 0;",
                "color: #ff2424; background: #fff; padding:5px 0;",
                "color: #ff2424; background: #fff; padding:5px 0;"
            ];
            window.console.log.apply(console, msg)
        });

        function scale(){
            var winWidth = screen.width;
            var winHeight = screen.height;

            var docWidth = document.body.clientWidth;
            var docHeight = document.body.clientHeight;

            var wp = docWidth / winWidth;//宽度缩放比例
            var hp = docHeight / winHeight;//高度缩放比例

            var $div = $('#content');
            $div.css('transform', "scale(" + wp + "," + hp + ")");
            $div.css('transform-origin', "0 0");
        }

        scale();
        window.onresize = function () {
            scale();
        }
    </script>
    <script>
        var timerele = document.getElementById('time');
        var dateele = document.getElementById('date');
        var weekele = document.getElementById('week');

        //获得URL参数
        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURI(r[2]);
            return null;
        }

        //获得服务器日期
        function getDatetime() {
            $.ajax({
                type: "POST",
                async: true,
                timeout: 15000,
                url: '../submit/Screen.ashx?type=getDate',
                success: function (backData) {
                    var data = backData;
                    if (data == null || data == '') {
                        console('获取服务器时间失败');
                    }
                    else {
                        var arr = data.split("|");
                        if (arr.length == 3) {
                            timerele.innerText = arr[1];
                            dateele.innerText = arr[0];
                            weekele.innerText = arr[2];
                        }
                    }
                }
            });
        }

        //获得产线生产计划
        function getLinePlan() {
            $.ajax({
                type: "POST",
                async: true,
                timeout: 15000,
                url: '../submit/Screen.ashx?type=linePlan',
                data: {
                    "PROD_LINE_ID": PROD_LINE_ID
                },
                success: function (backData) {
                    var data = eval("(" + backData + ")");
                    if (data == null || data == '') {
                        console('获取 生产计划 数据失败');
                    }
                    else {
                        if (data.Error_Msg == "SUCCESS") {
                            $("#bc").html(data.SHIFT_NAME);
                            $("#dd").html(data.MAKE_ORDER);
                            $("#xh").html(data.SMALL_MODEL_TYPE);
                            $("#mb").html(data.PLANCOUNT);
                            $("#wc").html(data.FINISHCOUNT);

                            $("#t2 tr:not(:first)").remove();
                            var len = data.rows.length;
                            debugger;
                            for (var i = 0; i < len; i++) {
                                trstr = "<tr>" +
                                    "<td>" + data.rows[i].JSON_MO_ORDER_BY + "</td>" +
                                    "<td>" + data.rows[i].JSON_MAKE_ORDER + "</td>" +
                                    "<td>" + data.rows[i].JSON_STANDARD_PRESON + "</td>" +
                                    "<td>" + data.rows[i].JSON_ACTUAL_PRESON + "</td>" +
                                    "<td>" + data.rows[i].JSON_MO_PLAN_COUNT + "</td>" +
                                    "<td>" + data.rows[i].JSON_MO_FINISH_COUNT + "</td>" +
                                    "<td>" + data.rows[i].JSON_MO_SIGN_DES + "</td>" +
                                    "</tr>";
                                $("#t2").append(trstr);
                            }
                            setAInt();
                        }
                    }
                }
            });
        }

        //获得生产环境
        function getLineEnvironment() {
            $.ajax({
                type: "POST",
                async: true,
                timeout: 15000,
                url: '../submit/Screen.ashx?type=lineEnvironment',
                data: {
                    "PROD_LINE_ID": PROD_LINE_ID
                },
                success: function (backData) {
                    var data = eval("(" + backData + ")");
                    if (data == null || data == '') {
                        console.log('获取 生产环境 数据失败');
                    }
                    else {
                        if (data.温度 != null && data.温度 != "") {
                            $("#wd").html(data.温度);
                        }
                        if (data.湿度 != null && data.湿度 != "") {
                            $("#sd").html(data.湿度);
                        }
                        if (data.噪声 != null && data.噪声 != "") {
                            $("#zs").html(data.噪声);
                        }
                        if (data.天盖压力 != null && data.天盖压力 != "") {
                            $("#tgyl").html(data.天盖压力);
                        }
                        if (data.地盖压力 != null && data.地盖压力 != "") {
                            $("#dgyl").html(data.地盖压力);
                        }
                        setBInt();
                    }
                }
            });
        }

        //获得品质监控
        function getLineQuality() {
            $.ajax({
                type: "POST",
                async: true,
                timeout: 15000,
                url: '../submit/Screen.ashx?type=lineQuality',
                data: {
                    "PROD_LINE_ID": PROD_LINE_ID
                },
                success: function (backData) {
                    var data = eval("(" + backData + ")");
                    if (data == null || data == '') {
                        console.log('获取 品质监控 数据失败');
                    }
                    else {
                        //console.log(data);
                        if (data.Error_Msg == "SUCCESS") {
                            if (data.QC_QJ_NG != null && data.QC_QJ_NG != "") {
                                $("#qj").html(data.QC_QJ_NG);
                            } else {
                                $("#qj").html("0");
                            }

                            if (data.QC_CJ_NG != null && data.QC_CJ_NG != "") {
                                $("#cj").html(data.QC_CJ_NG);
                            } else {
                                $("#cj").html("0");
                            }

                            if (data.QC_FX_NG != null && data.QC_FX_NG != "") {
                                $("#fx").html(data.QC_FX_NG);
                            } else {
                                $("#fx").html("0");
                            }
                            setCInt();
                        }
                    }
                }
            });
        }
        
        //1分钟获取一次
        var Aint = null;
        function setAInt() {
            Aint = setInterval(() => {
                clearInterval(Aint);
                getLinePlan();
            }, 60000);
        }
        
        //5秒获取一次
        var Bint = null;
        function setBInt() {
            Bint = setInterval(() => {
                clearInterval(Bint);
                getLineEnvironment();
            }, 5000);
        }
        
        //半分钟获取一次
        var Cint = null;
        function setCInt() {
            Cint = setInterval(() => {
                clearInterval(Cint);
                getLineQuality();
            }, 30000);
        }

        $(() => {
            PROD_LINE_ID = GetQueryString("LINE_ID");
            if (PROD_LINE_ID == "1" || PROD_LINE_ID == "2" || PROD_LINE_ID == "3" || PROD_LINE_ID == "4") {
                getDatetime();
                
                //时间定时器
                setInterval(() => {
                    getDatetime();
                }, 30000);

                getLinePlan();
                getLineEnvironment();
                getLineQuality();

            } else {
                alert("URL产线参数不正确 LINE_ID 必须是1~4");
            }
        });

    </script>
</body>

</html>